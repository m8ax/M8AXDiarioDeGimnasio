<!DOCTYPE html>
<html lang="es">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>M8AX - Clima Provincias España</title>
    <style>
        html, body {
        margin: 0;
        padding: 0;
        background: #000;
        font-family: Arial, sans-serif;
        width: 100%;
        overflow-y: auto;
        }
        #canvas {
        position: fixed;
        top: 0; left: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
        }
        #contenedor {
        position: relative;
        z-index: 1;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        width: 100%;
        max-width: 420px;
        margin: 0 auto;
        padding-bottom: 50px;
        }
        .ciudad {
        width: 33.33%;
        box-sizing: border-box;
        padding: 5px;
        }
        .cuadro {
        background: rgba(255,255,255,0.1);
        color: #fff;
        border-radius: 10px;
        text-align: center;
        padding: 12px 0;
        box-shadow: 0 4px 10px rgba(255,255,255,0.2);
        backdrop-filter: blur(5px);
        transition: background 0.5s;
        cursor: pointer;
        }
        .nombre { font-size: 14px; font-weight: bold; margin-bottom: 3px; }
        .temp { font-size: 18px; margin-bottom: 2px; }
        .desc { font-size: 11px; margin-bottom: 2px; }
        .hora { font-size: 10px; color: #ccc; }
        a { text-decoration: none; color: inherit; display: block; }
    </style>
</head>
<body>
<canvas id="canvas"></canvas>
<div id="contenedor"></div>
<script>
    const ciudades = [
       "Logroño,ES",
       "Nájera,ES",
       "Sevilla,ES",
       "Málaga,ES",
       "Cádiz,ES",
       "Córdoba,ES",
       "Granada,ES",
       "Huelva,ES",
       "Jaén,ES",
       "Almería,ES",
       "Zaragoza,ES",
       "Huesca,ES",
       "Teruel,ES",
       "Oviedo,ES",
       "Palma,ES",
       "Las Palmas De Gran Canaria,ES",
       "Santa Cruz De Tenerife,ES",
       "Santander,ES",
       "Toledo,ES",
       "Ciudad Real,ES",
       "Albacete,ES",
       "Cuenca,ES",
       "Guadalajara,ES",
       "Valladolid,ES",
       "Burgos,ES",
       "León,ES",
       "Palencia,ES",
       "Salamanca,ES",
       "Segovia,ES",
       "Soria,ES",
       "Ávila,ES",
       "Zamora,ES",
       "Barcelona,ES",
       "Lleida,ES",
       "Girona,ES",
       "Tarragona,ES",
       "Valencia,ES",
       "Alicante,ES",
       "Castellón De La Plana,ES",
       "Mérida,ES",
       "Badajoz,ES",
       "Santiago De Compostela,ES",
       "A Coruña,ES",
       "Lugo,ES",
       "Ourense,ES",
       "Pontevedra,ES",
       "Madrid,ES",
       "Murcia,ES",
       "Pamplona,ES",
       "Vitoria-Gasteiz,ES",
       "Bilbao,ES",
       "San Sebastián,ES",
       "Ceuta,ES",
       "Melilla,ES",
    ];
    const contenedor = document.getElementById('contenedor');
    function crearCuadros() {
        contenedor.innerHTML = '';
        ciudades.forEach(ciudad => {
            const div = document.createElement('div');
            div.className = 'ciudad';
            div.innerHTML = `<a href="https://wttr.in/${encodeURIComponent(ciudad)}" target="_blank">
                <div class="cuadro">
                    <div class="nombre">${ciudad}</div>
                    <div class="temp">--°C</div>
                    <div class="desc">Cargando...</div>
                    <div class="hora">--:--</div>
                </div>
            </a>`;
            contenedor.appendChild(div);
        });
    }
    async function actualizarClimas() {
        const cuadros = document.querySelectorAll('.ciudad');
        const promesas = ciudades.map((ciudad,i) =>
            fetch(`https://wttr.in/${ciudad}?format=j1`)
                .then(resp => resp.json())
                .then(data => ({
                    i,
                    temp: parseFloat(data.current_condition[0].temp_C),
                    desc: data.current_condition[0].weatherDesc[0].value
                }))
                .catch(() => ({i, temp: null, desc:'Error'}))
        );
        const resultados = await Promise.all(promesas);
        const ahora = new Date();
        const horaStr = ahora.getHours().toString().padStart(2,'0') + ':' +
                        ahora.getMinutes().toString().padStart(2,'0');
        resultados.forEach(r => {
            cuadros[r.i].querySelector('.temp').textContent = (r.temp !== null ? r.temp : '--') + '°C';
            cuadros[r.i].querySelector('.desc').textContent = r.desc;
            cuadros[r.i].querySelector('.hora').textContent = 'Actualizado - ' + horaStr;
            cuadros[r.i].querySelector('.cuadro').style.background = 'rgba(255,255,255,0.1)';
        });
        const tempsValidas = resultados.filter(r => r.temp !== null);
        if(tempsValidas.length === 0) return;
        const maxTemp = Math.max(...tempsValidas.map(r=>r.temp));
        const minTemp = Math.min(...tempsValidas.map(r=>r.temp));
        resultados.forEach(r => {
            const cuadro = cuadros[r.i].querySelector('.cuadro');
            if(r.temp === maxTemp) cuadro.style.background = 'rgba(255,0,0,0.6)';
            if(r.temp === minTemp) cuadro.style.background = 'rgba(0,200,255,0.6)';
        });
    }
    crearCuadros();
    actualizarClimas();
    setInterval(actualizarClimas, 60000);
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    let w = canvas.width = window.innerWidth;
    let h = canvas.height = window.innerHeight;
    window.addEventListener('resize', () => {
        w = canvas.width = window.innerWidth;
        h = canvas.height = window.innerHeight;
    });
    const numParticulas = 150;
    const particulas = [];
    function randomColor() {
        const colors = ['#ff4c4c','#ff9f1c','#ffe400','#32ff7e','#18dcff','#7d5fff','#ff6f91'];
        return colors[Math.floor(Math.random()*colors.length)];
    }
    for(let i=0;i<numParticulas;i++){
        particulas.push({
            x: Math.random()*w,
            y: Math.random()*h,
            r: Math.random()*2+1,
            dx: (Math.random()-0.5)*1.5,
            dy: (Math.random()-0.5)*1.5,
            alpha: Math.random()*0.5+0.3,
            color: randomColor()
        });
    }
    function dibujarParticulas(){
        ctx.clearRect(0,0,w,h);
        particulas.forEach(p=>{
            ctx.beginPath();
            ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
            ctx.fillStyle = `rgba(${parseInt(p.color.slice(1,3),16)},${parseInt(p.color.slice(3,5),16)},${parseInt(p.color.slice(5,7),16)},${p.alpha})`;
            ctx.fill();
            ctx.closePath();
            p.x += p.dx;
            p.y += p.dy;
            if(p.x <0 || p.x>w) p.dx*=-1;
            if(p.y <0 || p.y>h) p.dy*=-1;
        });
        for(let i=0;i<numParticulas;i++){
            for(let j=i+1;j<numParticulas;j++){
                let dx = particulas[i].x - particulas[j].x;
                let dy = particulas[i].y - particulas[j].y;
                let distancia = Math.sqrt(dx*dx + dy*dy);
                if(distancia<80){
                    ctx.beginPath();
                    ctx.strokeStyle = `rgba(255,255,255,0.1)`;
                    ctx.lineWidth = 1;
                    ctx.moveTo(particulas[i].x, particulas[i].y);
                    ctx.lineTo(particulas[j].x, particulas[j].y);
                    ctx.stroke();
                    ctx.closePath();
                }
            }
        }
        requestAnimationFrame(dibujarParticulas);
    }
    dibujarParticulas();
</script>
</body>
</html>